# K Shot

> 知識や情報を管理・共有するためのナレッジ管理ツール

[![Next.js](https://img.shields.io/badge/Next.js-15.1.0-black)](https://nextjs.org/)
[![React](https://img.shields.io/badge/React-19.0.0-blue)](https://reactjs.org/)
[![TypeScript](https://img.shields.io/badge/TypeScript-5.7.0-blue)](https://www.typescriptlang.org/)
[![SQLite](https://img.shields.io/badge/SQLite-better--sqlite3-green)](https://github.com/WiseLibs/better-sqlite3)

## 📋 目次

- [概要](#概要)
- [主な機能](#主な機能)
- [技術スタック](#技術スタック)
- [セットアップ](#セットアップ)
- [使用方法](#使用方法)
- [プロジェクト構造](#プロジェクト構造)
- [データベース](#データベース)
- [開発](#開発)
- [ライセンス](#ライセンス)

## 概要

K Shotは、組織内で知識や情報を効率的に管理・共有するためのナレッジ管理システムです。ネットワークドライブ上にSQLiteデータベースを配置し、複数ユーザーが同時にアクセスできる設計になっています。

### 特徴

- 📁 **ファイルベースのデータ管理**: ネットワークドライブ上にSQLiteデータベースを配置
- 👥 **マルチユーザー対応**: 複数ユーザーが同時にアクセス可能
- 🔐 **デバイストークン認証**: セキュアな認証システム
- 📊 **統計・分析機能**: アクティビティグラフやランキング表示
- 🔔 **通知システム**: リアルタイム通知機能
- 🗂️ **階層フォルダ管理**: 資料をフォルダで整理
- 💬 **コメント機能**: 資料へのコメントや返信が可能
- 🗑️ **ゴミ箱機能**: 削除した資料の復元が可能

## 主な機能

### 基本機能

- **ホーム**: システムの概要とクイックアクセス、閲覧履歴の表示
- **共有資料**: 学習資料の管理、アップロード、閲覧
- **お気に入り**: お気に入り資料の一覧表示
- **全体状況**: 統計情報とランキング（アクティビティグラフ、カテゴリ・タイプ別グラフ）
- **利用者一覧**: チームメンバーの管理
- **プロフィール**: プロフィール編集、アバター画像編集、スキル・資格・職場内資格情報の管理
- **ゴミ箱**: 削除された資料・フォルダの管理と復元

### 検索・通知機能

- **グローバル検索**: ヘッダーに配置された検索機能、検索履歴、リアルタイム検索候補表示
- **通知システム**: Windows通知対応、通知一覧表示、未読/既読管理

### 管理機能（管理者のみ）

- **設定**: ネットワークドライブ設定、通知設定、バックアップ設定、データ管理設定、アカウント管理
- **データベース管理**: データベースの直接編集
- **エラーチェック**: ログの閲覧とエラー確認
- **ご意見・ご要望管理**: フィードバックの管理

## 技術スタック

### フロントエンド

- **Next.js 15**: App Routerを使用したサーバーサイドレンダリング
- **React 19**: UIライブラリ
- **TypeScript**: 型安全性の確保
- **Tailwind CSS**: スタイリング
- **Lucide React**: アイコンライブラリ
- **Recharts**: グラフ表示
- **react-markdown**: Markdown表示

### バックエンド

- **Next.js API Routes**: サーバーサイドAPI
- **SQLite (better-sqlite3)**: データベース
- **ファイルシステム**: 添付ファイルやアバター画像の保存

### 開発ツール

- **Vitest**: テストフレームワーク
- **ESLint**: コードリンティング
- **TypeScript**: 型チェック

## セットアップ

### 必要な環境

- **OS**: Windows 10/11
- **Node.js**: v18.17 以上（推奨: v20.x LTS または v25.x）
- **Visual Studio C++ Build Tools**: `better-sqlite3`のビルドに必要
  - Visual Studio 2022 Community以上
  - ワークロード: "Desktop development with C++"

### インストール手順

1. **リポジトリをクローン**

```bash
git clone https://github.com/yominosekai/K_Shot.git
cd K_Shot
```

2. **依存関係をインストール**

```bash
npm install
```

3. **開発サーバーを起動**

```bash
npm run dev
```

4. **ブラウザでアクセス**

```
http://localhost:3000
```

### 初回セットアップ

初回起動時は、初期設定画面が表示されます。

1. ネットワークドライブをマウント
2. ドライブレターを選択
3. 設定を保存

詳細な手順は、アプリケーション内の「ヘルプ」ページを参照してください。

## 使用方法

### 基本的な使い方

1. **資料のアップロード**
   - 「共有資料」ページから「新規作成」をクリック
   - タイトル、本文、カテゴリなどを入力
   - 添付ファイルを追加
   - 「保存」をクリック

2. **資料の閲覧**
   - 「共有資料」ページから資料を選択
   - モーダルで詳細を確認
   - 添付ファイルを開く、ダウンロード、ZIPダウンロードが可能

3. **お気に入り登録**
   - 資料詳細画面で「お気に入り」ボタンをクリック
   - 「お気に入り」ページで一覧表示

4. **コメントの追加**
   - 資料詳細画面で「コメント」ボタンをクリック
   - コメントを入力して送信
   - 返信も可能

詳細な使用方法は、アプリケーション内の「ヘルプ」ページを参照してください。

## プロジェクト構造

```
K_Shot/
├── src/                    # ソースコード
│   ├── app/                # Next.js App Router（ページ・API）
│   │   ├── admin/          # 管理機能
│   │   ├── api/             # API Routes
│   │   ├── materials/       # 資料管理
│   │   ├── members/         # 利用者一覧
│   │   ├── profile/         # プロフィール
│   │   └── setup/           # 初期設定
│   ├── components/          # 共通コンポーネント
│   ├── contexts/            # React Context
│   ├── features/            # 機能別モジュール
│   ├── shared/              # 共通機能（ライブラリ、フック）
│   ├── config/              # 設定ファイル
│   └── types/               # 型定義
├── documents/               # ドキュメント
├── scripts/                 # スクリプト（データベース初期化など）
├── public/                  # 静的ファイル（ロゴ、マニュアルなど）
└── package.json            # プロジェクト設定
```


## データベース

このシステムは**SQLite**（`better-sqlite3`）を使用して共有データを管理します。

### データベースファイル

- **パス**: `{ドライブレター}:\k_shot\shared\k_shot.db`
- **同時アクセス対応**: DELETEモード（journal_mode）により、ネットワークドライブ上での複数ユーザーの同時読み書きに対応
  - **注意**: WALモードはSMB共有で同期が不安定になるため、DELETEモードを使用しています

### 主要テーブル

- `materials`: 共有資料
- `material_revisions`: 資料更新履歴
- `folders`: フォルダ
- `categories`: カテゴリ
- `material_types`: 資料タイプ
- `difficulty_levels`: 難易度
- `departments`: 部署
- `users`: ユーザー
- `device_tokens`: デバイストークン
- `material_likes`: いいね
- `material_views`: 閲覧履歴
- `material_comments`: コメント
- `notifications`: 通知
- `user_activities`: ユーザーアクティビティ記録
- `system_config`: システム設定
- `feedback_metadata`: フィードバック


## 開発

### 開発サーバーの起動

```bash
npm run dev
```

### ビルド

```bash
npm run build
```

### 本番環境での起動

```bash
npm start
```

### テスト

```bash
# テストを実行（ウォッチモード）
npm test

# テストを1回だけ実行
npm run test:run

# テストUIを開く
npm run test:ui

# カバレッジレポートを生成
npm run test:coverage
```

### 型チェック

```bash
npm run type-check
```

### リンティング

```bash
npm run lint
```



## ライセンス

このプロジェクトは [MIT License](LICENSE) の下で公開されています。

## コントリビューション

コントリビューションを歓迎します。プルリクエストを送信する前に、以下の点を確認してください。

1. コードスタイルに従っているか
2. テストが通っているか
3. ドキュメントが更新されているか

## 更新履歴

### v1.0.0 (2025-01-20)

- 管理者マニュアルの追加
- 開発者の考え方と残しておきたいことページの追加
- バージョン情報ページのアコーディオン機能
- ヘルプページのドキュメントセレクター改善（単一ドキュメント時は非表示）
- 利用者マニュアルをテキストベースに変更（画像削除、初回ユーザー向けに簡素化）
- 各種ドキュメントの正確性向上（コードとの整合性確認・修正）
- ヘルプページのファイル読み込みロジック改善（開発時はsrc優先）
- 大規模リファクタリング完了（主要コンポーネントの分割・カスタムフック化）
- JSXを含むファイルの.tsxへの変更（ビルドエラー修正）
- ヘルプページのヘッダーUI調整
- ドキュメントの権限管理改善（管理者専用ドキュメントの表示制御）
- MIT Licenseの追加

### v0.9.0 (2025-01-17)

- 基本機能の実装
- ユーザー認証システム（デバイストークン認証）
- 共有資料のアップロード・編集・削除機能
- 階層表示機能
- 検索機能（グローバル検索、共有資料検索）
- お気に入り機能
- コメント機能
- 通知システム
- メンバー管理
- 設定管理
- ゴミ箱機能
- ヘルプ・マニュアル機能
- バージョン情報ページ

### v0.8.0 (2025-11-23)

- ドキュメント整備
- テストフレームワーク情報の追加

### v0.7.0 (2025-11-12)

- 大規模リファクタリング完了
- 設計原則に準拠したコード構造


---

**K Shot** - 知識や情報を管理・共有するためのナレッジ管理ツール

