# 👨‍💼 管理者マニュアル

ナレッジ管理システム（K-Shot）の管理者専用機能の使い方をまとめています。管理者権限を持つユーザー向けの操作手順です。

---

## 1. 設定ページ（/admin）

「設定」メニューから、システム全体の設定を管理できます。

### 1.1 アカウント管理

ユーザーアカウントの管理ができます。

- **ユーザー一覧**: 登録されている全ユーザーを一覧表示
- **権限変更**: ユーザーの権限（一般ユーザー/講師/管理者）を変更
- **アカウント削除**: 不要なアカウントを削除

> ⚠️ **注意**  
> アカウント削除は取り消せません。削除前に必ず確認してください。

### 1.2 パスワード管理

権限変更時のパスワードを設定・変更できます。

- **管理者権限変更パスワード**: 管理者権限に変更する際に必要なパスワード
- **講師権限変更パスワード**: 講師権限に変更する際に必要なパスワード
- **デフォルトパスワード確認**: デフォルトパスワードが設定されている場合、警告が表示されます

> 💡 **セキュリティ**  
> デフォルトパスワードのまま運用しないよう、必ず変更してください。

### 1.3 データベースバックアップ設定

データベースの自動バックアップを設定できます。

- **自動バックアップ有効化**: チェックボックスで有効/無効を切り替え
- **実行時間**: 12:00-18:00の間で実行時刻を設定（例: 14:30）
- **保存先**: バックアップファイルの保存先を指定（デフォルト: `backups`）
- **保持期間**: バックアップファイルを保持する日数（デフォルト: 30日）

> 💡 **ヒント**  
> 自動バックアップは、ページが開いている間のみ実行されます。ブラウザを閉じると実行されません。

### 1.4 データベースバックアップ・復元

データベースの手動バックアップと復元ができます。

- **手動バックアップ**: 「バックアップをダウンロード」ボタンで、現在のデータベースをバックアップファイルとしてダウンロード
- **復元**: バックアップファイルを選択してデータベースを復元

> ⚠️ **重要**  
> 復元を実行すると、現在のデータベースがバックアップファイルの内容で上書きされます。復元前に自動的にバックアップが作成されますが、重要な操作のため慎重に行ってください。

### 1.5 デバイストークン管理

ユーザーのデバイストークンを管理できます。

- **デバイストークン一覧**: 登録されている全デバイストークンを表示
- **トークンの無効化**: 特定のデバイストークンを無効化（ログアウト）
- **トークンのインポート**: 証明ファイル（`device-token.json`）をインポートして、他の端末からアクセス可能にする

---

## 2. データベース管理（/admin/database）

データベースのテーブルを直接閲覧・編集できます。

### 2.1 テーブル一覧

- **ネットワークDB**: 共有フォルダ上のデータベース（`{ドライブ}:\k_shot\shared\k_shot.db`）
- **ローカルDB**: ローカルのデータベース（開発用）

### 2.2 テーブルの操作

- **閲覧**: テーブルを選択すると、データが一覧表示されます
- **編集**: 行をクリックして編集モードにし、値を変更して保存
- **追加**: 「新規追加」ボタンで新しい行を追加
- **削除**: 行を選択して「削除」ボタンで削除

> ⚠️ **注意**  
> データベースの直接編集は、システムの整合性に影響を与える可能性があります。操作前に必ずバックアップを取得してください。

---

## 3. ログ閲覧（/admin/logs）

システムのエラーログやSQLITE_BUSYログを確認できます。

### 3.1 ログの種類

- **エラーログ**: システムで発生したエラー（`users/{user_id_hash}/logs/errors.json`）
- **SQLITE_BUSYログ**: データベースのロック競合（`users/{user_id_hash}/logs/sqlite_busy.log`）

### 3.2 フィルタリング機能

- **ログ種別**: エラーログ/SQLITE_BUSYログ/すべて
- **ユーザー**: 特定のユーザーのログのみ表示
- **期間**: 開始日と終了日を指定
- **キーワード検索**: ログメッセージ内のテキストを検索

### 3.3 ログの確認

- **ソート**: タイムスタンプ、ユーザー、ログ種別でソート可能
- **ページネーション**: 大量のログを効率的に閲覧
- **統計情報**: ログの総数や種別ごとの件数を表示

---

## 4. フィードバック管理（/admin/feedback）

ユーザーから投稿されたフィードバックを管理できます。

### 4.1 フィードバック一覧

- **ステータスフィルター**: 未対応/対応中/対応済み/却下で絞り込み
- **公開設定フィルター**: 公開/非公開で絞り込み
- **詳細表示**: 各フィードバックの詳細情報を確認

### 4.2 フィードバックの操作

- **ステータス変更**: フィードバックの対応状況を更新
- **公開設定**: フィードバックを公開/非公開に設定
- **レスポンス**: フィードバックに対して管理者として返信
- **削除**: 不要なフィードバックを削除

---

## 5. 全体状況ページ（/overview）

システム全体の統計情報を確認できます。

### 5.1 主要指標

- **資料数**: 登録されている資料の総数
- **ユーザー数**: 登録されているユーザーの総数
- **カテゴリ数**: 登録されているカテゴリの総数

### 5.2 アクティビティグラフ

- **期間選択**: 7日/30日/90日/365日
- **粒度選択**: 日次/週次/月次
- **ユーザーアクティビティ**: ログインや資料閲覧の推移
- **資料アクティビティ**: 資料の作成・更新・閲覧の推移

### 5.3 カテゴリ・タイプ別分析

- **カテゴリ別統計**: カテゴリごとの資料数や閲覧数
- **タイプ別統計**: 資料タイプごとの分布

### 5.4 資料ランキング

- **いいね数**: いいねが多い資料のランキング
- **お気に入り数**: お気に入り登録が多い資料のランキング
- **閲覧数**: 閲覧数が多い資料のランキング

---

## 6. よくある質問

### Q. バックアップが自動実行されない

A. 自動バックアップは、ページが開いている間のみ実行されます。また、実行時間は12:00-18:00の間である必要があります。ブラウザを閉じている間は実行されません。

### Q. データベースを編集したらエラーが出た

A. データベースの直接編集は、システムの整合性に影響を与える可能性があります。必ずバックアップを取得してから操作してください。エラーが発生した場合は、バックアップから復元してください。

### Q. ユーザーの権限を変更できない

A. 権限変更には、対応するパスワードが必要です。「設定」→「パスワード管理」でパスワードが設定されているか確認してください。

### Q. ログが多すぎて確認できない

A. ログ閲覧ページのフィルタリング機能を使用して、期間やユーザー、キーワードで絞り込んでください。また、ページネーション機能で効率的に閲覧できます。

---

困ったときは、ヘッダーの「ヘルプ」メニューから各種ドキュメント（プロジェクト理解資料、設計・ロジック資料、トラブルシューティングなど）を参照してください。
